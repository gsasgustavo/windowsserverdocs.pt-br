---
description: 'Saiba mais sobre: avenidas a serem comprometidos'
ms.assetid: d7a4d2e1-217d-4ffc-93f0-817149bd9e7f
title: Alternativas ao comprometimento
author: iainfoulds
ms.author: daveba
manager: daveba
ms.date: 05/31/2017
ms.topic: article
ms.openlocfilehash: f85fdb8c723972ce1d441d45510b738d0e166cff
ms.sourcegitcommit: 65b6de6b44d41f1180c45db11cdd60cb2a093b46
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 12/10/2020
ms.locfileid: "97045504"
---
# <a name="avenues-to-compromise"></a>Alternativas ao comprometimento

>Aplica-se a: Windows Server 2016, Windows Server 2012 R2, Windows Server 2012

*Número da lei sete: a rede mais segura é uma bem administrada.* - [10 leis imutáveis da administração de segurança](/previous-versions/cc722488(v=technet.10))

Em organizações que experimentaram eventos de comprometimento catastróficos, as avaliações normalmente revelam que as organizações têm visibilidade limitada do estado real de suas infraestruturas de ti, o que pode diferir significativamente dos Estados "conforme documentado". Essas variações introduzem vulnerabilidades que expõem o ambiente a ser comprometido, geralmente com pouco risco de descoberta até que o comprometimento tenha progredido até o ponto em que os invasores efetivamente "têm" o ambiente.

As avaliações detalhadas das AD DS configuração, infraestruturas de chave pública (PKIs), servidores, estações de trabalho, aplicativos, ACLs (listas de controle de acesso) e outras tecnologias revelam configurações e vulnerabilidades incorretas que, se corrigidas, poderiam ter impedido o comprometimento inicial.

A análise da documentação, dos processos e dos procedimentos de ti identifica as vulnerabilidades introduzidas por lacunas nas práticas administrativas que foram aproveitadas pelos invasores para, eventualmente, obter privilégios que foram usados para comprometer totalmente a floresta Active Directory. Uma floresta totalmente comprometida é aquela em que os invasores comprometem não apenas sistemas individuais, aplicativos ou contas de usuário, mas escalonam seu acesso para obter um nível de privilégio no qual eles podem modificar ou destruir todos os aspectos da floresta. Quando uma instalação de Active Directory foi comprometida com esse grau, os invasores podem fazer alterações que permitam manter uma presença em todo o ambiente, ou pior, para destruir o diretório e os sistemas e as contas que ele gerencia.

Embora uma série de vulnerabilidades normalmente exploradas nas descrições que se seguem não sejam ataques contra Active Directory, elas permitem que os invasores estabeleçam um destaque em um ambiente que possa ser usado para executar ataques de elevação de privilégio (também chamados de privilégios de privilégio) e, eventualmente, direcionar e comprometer AD DS.

Esta seção deste documento se concentra na descrição dos mecanismos que os invasores normalmente usam para obter acesso à infraestrutura e, eventualmente, iniciar ataques de elevação de privilégios. Consulte também as seguintes seções:

-   [Reduzindo a superfície de ataque de Active Directory](../../../ad-ds/plan/security-best-practices/../../../ad-ds/plan/security-best-practices/../../../ad-ds/plan/security-best-practices/Reducing-the-Active-Directory-Attack-Surface.md) Recomendações detalhadas para a configuração segura do Active Directory.

-   [Active Directory de monitoramento para sinais de comprometimento](../../../ad-ds/plan/security-best-practices/Monitoring-Active-Directory-for-Signs-of-Compromise.md) Recomendações para ajudar a detectar o comprometimento

-   [Planejando o comprometimento](../../../ad-ds/plan/security-best-practices/../../../ad-ds/plan/security-best-practices/Planning-for-Compromise.md) Abordagens de alto nível para ajudar a se preparar para ataques contra a infraestrutura de perspectivas de ti e de negócios

> [!NOTE]
> Embora este documento se concentre em Active Directory e em sistemas Windows que fazem parte de um domínio de AD DS, os invasores raramente se concentram apenas no Active Directory e no Windows. Em ambientes com uma mistura de sistemas operacionais, diretórios, aplicativos e repositórios de dados, é comum descobrir que sistemas não Windows também foram comprometidos. Isso é especialmente verdadeiro se os sistemas fornecerem uma "ponte" entre ambientes Windows e não Windows, como servidores de arquivos acessados por clientes Windows e UNIX ou Linux, diretórios que fornecem serviços de autenticação para vários sistemas operacionais ou metadiretórios que sincronizam dados em diretórios diferentes.
>
> O AD DS é direcionado por causa dos recursos de gerenciamento centralizado de acesso e configuração que ele fornece não apenas para sistemas Windows, mas para outros clientes. Qualquer outro diretório ou aplicativo que forneça serviços de autenticação e gerenciamento de configuração pode e será direcionado por determinados invasores. Embora este documento se concentre em proteções que podem reduzir a probabilidade de um comprometimento de instalações de Active Directory, todas as organizações que incluem computadores não Windows, diretórios, aplicativos ou repositórios de dados também devem se preparar para ataques contra esses sistemas.

## <a name="initial-breach-targets"></a>Destinos de violação iniciais
Ninguém cria intencionalmente uma infraestrutura de ti que expõe a organização a ser comprometida. Quando uma floresta Active Directory é construída pela primeira vez, ela geralmente é original e atual. À medida que os anos passam e novos sistemas operacionais e aplicativos são adquiridos, eles são adicionados à floresta. Como os benefícios da capacidade de gerenciamento que Active Directory fornece são reconhecidos, cada vez mais conteúdo é adicionado ao diretório, mais pessoas integram seus computadores ou aplicativos com AD DS, e os domínios são atualizados para dar suporte à nova funcionalidade oferecida pelas versões mais atuais do sistema operacional Windows. No entanto, o que também acontece ao longo do tempo é que, mesmo que uma nova infraestrutura esteja sendo adicionada, outras partes da infra-estrutura podem não ser mantidas, assim como inicialmente, os sistemas e aplicativos estão funcionando corretamente e, portanto, não estão recebendo atenção, e as organizações começam a se esquecer de que não eliminaram sua infraestrutura herdada. Com base no que vemos na avaliação de infraestruturas comprometidas, o ambiente mais antigo, maior e mais complexo, maior é a probabilidade de que haja várias instâncias de vulnerabilidades comumente exploradas.

Independentemente da motivação do invasor, a maioria das violações de segurança de informações começa com o comprometimento de um ou dois sistemas de cada vez. Esses eventos iniciais, ou pontos de entrada na rede, geralmente aproveitam as vulnerabilidades que poderiam ter sido corrigidas, mas não foram. O [DBIR (relatório de investigações de violações de dados) 2012](http://www.verizonbusiness.com/resources/reports/rp_data-breach-investigations-report-2012_en_xg.pdf), que é um estudo anual produzido pela equipe de risco Verizon em cooperação com várias agências de segurança nacionais e outras empresas, afirma que 96% dos ataques foram "não altamente difíceis" e que "97% das violações foram podem ser evitados por meio de controles simples ou intermediários". Essas descobertas podem ser uma consequência direta das vulnerabilidades mais exploradas que se seguem.

### <a name="gaps-in-antivirus-and-antimalware-deployments"></a>Falhas em implantações de antivírus e antimalware
*Número da lei oito: um verificador de malware desatualizado é apenas marginalmente melhor do que nenhum scanner.* - [Dez leis imutáveis de segurança (versão 2,0)](https://www.microsoft.com/en-us/msrc?rtc=1)

A análise das implantações antivírus e antimalware das organizações geralmente revela um ambiente no qual a maioria das estações de trabalho são configuradas com software antivírus e antimalware habilitado e atual. As exceções geralmente são estações de trabalho que se conectam raramente ao ambiente corporativo ou aos dispositivos de funcionários para os quais softwares antivírus e antimalware podem ser difíceis de implantar, configurar e atualizar.

No entanto, as populações do servidor tendem a ser protegidas com menos consistência em muitos ambientes comprometidos. Conforme relatado nas [investigações de violação de dados de 2012](http://www.verizonbusiness.com/resources/reports/rp_data-breach-investigations-report-2012_en_xg.pdf), 94% de todos os dados comprometi os servidores envolvidos, que representa um aumento de 18% no ano anterior e 69% dos ataques incorporados ao malware. Em populações de servidor, não é incomum descobrir que as instalações antivírus e antimalware estão configuradas inconsistentes, desatualizadas, configuradas incorretamente ou até mesmo desabilitadas. Em alguns casos, o software antivírus e antimalware é desabilitado pela equipe administrativa, mas em outros casos, os invasores desativam o software depois de comprometer um servidor por meio de outras vulnerabilidades. Quando o antivírus e o software antimalware estão desabilitados, os invasores fazem a fábrica de malware no servidor e se concentram em propagar o comprometimento na população do servidor.

É importante não apenas garantir que seus sistemas estejam protegidos com proteção de malware atual e abrangente, mas também para monitorar sistemas para desabilitar ou remover software antivírus e antimalware e para reiniciar automaticamente a proteção quando ela for desabilitada manualmente. Embora nenhum software antivírus e antimalware possa garantir a prevenção e detecção de todas as infecções, uma implementação antivírus e implantada corretamente configurada e immalware pode reduzir a probabilidade de infecção.

### <a name="incomplete-patching"></a>Aplicação de patch incompleta
*Número da lei três: se você não acompanhar as correções de segurança, sua rede não será a sua por tempo.* - [10 leis imutáveis da administração de segurança](/previous-versions/cc722488(v=technet.10))

A Microsoft lança boletins de segurança na segunda terça-feira de cada mês, embora em raras ocasiões as atualizações de segurança sejam lançadas entre as atualizações de segurança mensais (elas também são conhecidas como atualizações "fora de banda") quando a vulnerabilidade é determinada para representar um risco urgente aos sistemas de clientes. Se uma pequena empresa configura seus computadores Windows para usar o Windows Update para gerenciar a aplicação de patches do sistema e de aplicativos ou uma grande organização usa software de gerenciamento como o Microsoft Endpoint Configuration Manager para implantar patches de acordo com planos detalhados e hierárquicos, muitos clientes correm suas infraestruturas do Windows de maneira relativamente oportuna.

No entanto, algumas infra-estruturas incluem apenas computadores Windows e aplicativos da Microsoft, e em ambientes comprometidos, é comum descobrir que a estratégia de gerenciamento de patches da organização contém lacunas. Os sistemas Windows nesses ambientes são corrigidos de forma inconsistente. Os sistemas operacionais que não são do Windows são corrigidos esporadicamente, se houver. Os aplicativos COTS (comerciais prontos para prateleira) contêm vulnerabilidades para as quais os patches existem, mas não foram aplicados. Os dispositivos de rede geralmente são configurados com credenciais padrão de fábrica e não há atualizações de firmware em anos após a instalação. Os aplicativos e sistemas operacionais que não têm mais suporte de seus fornecedores geralmente são mantidos em execução, apesar do fato de que eles não podem mais ser corrigidos contra vulnerabilidades. Cada um desses sistemas sem patch representa outro ponto de entrada potencial para invasores.

O consumo de ti introduziu desafios adicionais nos dispositivos de Propriedade do funcionário que estão sendo usados para acessar dados corporativos, e a organização pode ter pouco ou nenhum controle sobre a aplicação de patches e a configuração dos dispositivos pessoais dos funcionários. O hardware de classe empresarial normalmente é fornecido com opções de configuração e recursos de gerenciamento prontos para a empresa, ao custo de menos opções na personalização individual e na seleção de dispositivos. O hardware voltado para funcionários oferece uma variedade maior de fabricantes, fornecedores, recursos de segurança de hardware, recursos de segurança de software, recursos de gerenciamento e opções de configuração, e muitos recursos empresariais podem estar ausentes.

#### <a name="patch-and-vulnerability-management-software"></a>Software de gerenciamento de patches e vulnerabilidades
Se um sistema de gerenciamento de patches eficaz estiver em vigor para os sistemas Windows e aplicativos da Microsoft, parte da superfície de ataque criada por vulnerabilidades sem patches foi resolvida. No entanto, a menos que os sistemas não Windows, aplicativos que não sejam da Microsoft, infraestrutura de rede e dispositivos de funcionários também sejam mantidos atualizados sobre patches e outras correções, a infraestrutura permanecerá vulnerável. Em alguns casos, o fornecedor de um aplicativo pode oferecer recursos de atualização automática; em outros, pode haver a necessidade de planejar uma abordagem para recuperar e aplicar patches e outras correções regularmente.

### <a name="outdated-applications-and-operating-systems"></a>Aplicativos e sistemas operacionais desatualizados
*"Você não pode esperar um sistema operacional com seis anos de idade para protegê-lo contra um ataque com seis meses de idade."* -Profissional de segurança de informações com 10 anos de experiência na proteção de instalações corporativas

Embora "Obtenha o atual, mantenha-se atualizado" possa parecer uma frase de marketing, sistemas operacionais e aplicativos desatualizados criam risco em muitas infra-estruturas de ti de organizações. Um sistema operacional que foi lançado no 2003 pode ainda ter suporte do fornecedor e fornecido com atualizações para tratar vulnerabilidades, mas esse sistema operacional pode não conter recursos de segurança adicionados em versões mais recentes do sistema operacional. Sistemas desatualizados podem até mesmo exigir o baixo de determinados AD DS configuração de segurança para dar suporte aos recursos menores desses computadores.

Os aplicativos que foram escritos para usar protocolos de autenticação herdados por fornecedores que não estão mais dando suporte ao aplicativo geralmente não podem ser recriados para dar suporte a mecanismos de autenticação mais fortes. No entanto, o domínio de Active Directory de uma organização ainda pode ser configurado para armazenar hashes do LAN Manager ou senhas criptografadas reversível para dar suporte a tais aplicativos. Os aplicativos escritos antes da introdução de sistemas operacionais mais recentes podem não funcionar bem ou em sistemas operacionais atuais, exigindo que as organizações mantenham sistemas antigos e mais antigos e, em alguns casos, hardware e software completamente sem suporte.

Mesmo em casos em que as organizações atualizaram seus controladores de domínio para o Windows Server 2012, o Windows Server 2008 R2 ou o Windows Server 2008, é comum encontrar partes significativas da população do servidor membro para executar o Windows Server 2003, o Windows 2000 Server ou o Windows NT Server 4,0 (sem suporte completo). Quanto mais longa a organização mantiver sistemas de duração, maior será a diferença entre os conjuntos de recursos e quanto mais provável ele se tornará não haverá suporte para os sistemas de produção. Além disso, quanto mais longa uma floresta Active Directory for mantida, mais observamos que os sistemas herdados e os aplicativos são perdidos nos planos de atualização. Isso pode significar que um único computador executando um único aplicativo pode introduzir vulnerabilidades em todo o domínio ou floresta porque Active Directory está configurado para dar suporte a seus protocolos herdados e mecanismos de autenticação.

Para eliminar sistemas e aplicativos herdados, primeiro você deve se concentrar na identificação e na catalogação deles e, em seguida, determinar se deseja atualizar ou substituir o aplicativo ou host. Embora possa ser difícil encontrar substituições para aplicativos altamente especializados para os quais não há suporte nem um caminho de atualização, você poderá aproveitar um conceito chamado "destruição criativa" para substituir o aplicativo herdado por um novo aplicativo que forneça a funcionalidade necessária. O [planejamento de comprometimento](../../../ad-ds/plan/security-best-practices/../../../ad-ds/plan/security-best-practices/Planning-for-Compromise.md) é descrito mais detalhadamente em "planejamento para o comprometimento", mais adiante neste documento.

### <a name="misconfiguration"></a>Configuração incorreta
*Número da lei quatro: não é muito bom instalar correções de segurança em um computador que nunca foi protegido para começar.* - [10 leis imutáveis da administração de segurança](/previous-versions/cc722488(v=technet.10))

Mesmo em ambientes em que os sistemas geralmente são mantidos atuais e corrigidos, normalmente identificamos falhas ou configurações incorretas no sistema operacional, aplicativos em execução em computadores e Active Directory. Algumas configurações incorretas expõem apenas o computador local a ser comprometido, mas depois que um computador é "de propriedade", os invasores geralmente se concentram em propagar ainda mais o comprometimento entre outros sistemas e, eventualmente, Active Directory. A seguir estão algumas das áreas comuns nas quais identificamos as configurações que introduzem o risco.

#### <a name="in-active-directory"></a>Em Active Directory
As contas em Active Directory que são mais comumente direcionadas por invasores são aquelas que são membros dos grupos mais altamente privilegiados, como membros dos grupos Administradores de domínio (DA), EA (administração de empresa) ou grupo de administradores internos (BA) no Active Directory. A associação desses grupos deve ser reduzida para o menor número de contas possível para que a superfície de ataque desses grupos seja limitada. É possível, até mesmo, eliminar a associação "permanente" nesses grupos privilegiados; ou seja, você pode implementar configurações que permitem popular temporariamente esses grupos somente quando seus privilégios de domínio e de toda a floresta são necessários. Quando contas altamente privilegiadas são usadas, elas devem ser usadas somente em sistemas seguros e designados, como controladores de domínio ou hosts administrativos seguros. Informações detalhadas para ajudar a implementar todas essas configurações são fornecidas na [redução da superfície de ataque Active Directory](../../../ad-ds/plan/security-best-practices/../../../ad-ds/plan/security-best-practices/../../../ad-ds/plan/security-best-practices/Reducing-the-Active-Directory-Attack-Surface.md).

Quando avaliamos a Associação dos grupos com maior privilégio no Active Directory, geralmente encontramos uma associação excessiva em todos os três grupos mais privilegiados. Em alguns casos, as organizações têm dezenas, mesmo centenas de contas em grupos DA. Em outros casos, as organizações colocam as contas diretamente em grupos de administradores internos, pensando que o grupo é "menos privilegiado" do que o grupo DAs. Não é. Muitas vezes, encontramos alguns membros permanentes do grupo EA no domínio raiz da floresta, apesar do fato de que os privilégios de EA raramente são e são necessários temporariamente. A localização de uma conta administrativa diária do usuário de ti em todos os três grupos também é comum, embora essa seja uma configuração efetivamente redundante. Conforme descrito em [reduzindo a superfície de ataque de Active Directory](../../../ad-ds/plan/security-best-practices/../../../ad-ds/plan/security-best-practices/../../../ad-ds/plan/security-best-practices/Reducing-the-Active-Directory-Attack-Surface.md), se uma conta é um membro permanente de um desses grupos ou de todas elas, a conta pode ser usada para comprometer e até mesmo destruir o ambiente de AD DS e os sistemas e as contas gerenciadas por ele. As recomendações para a configuração segura e o uso de contas com privilégios no Active Directory são fornecidas na [redução da superfície de ataque de Active Directory](../../../ad-ds/plan/security-best-practices/../../../ad-ds/plan/security-best-practices/../../../ad-ds/plan/security-best-practices/Reducing-the-Active-Directory-Attack-Surface.md).

#### <a name="on-domain-controllers"></a>Em controladores de domínio
Quando avaliamos os controladores de domínio, encontramos muitas vezes eles são configurados e gerenciados não de maneira diferente dos servidores membro. Os controladores de domínio às vezes executam os mesmos aplicativos e utilitários instalados em servidores membros, não porque eles são necessários nos controladores de domínio, mas porque os aplicativos fazem parte de uma compilação padrão. Esses aplicativos podem fornecer funcionalidade mínima nos controladores de domínio, mas aumentam significativamente a sua superfície de ataque, exigindo configuração que abrem portas, criam contas de serviço altamente privilegiadas ou concedem acesso ao sistema por usuários que não devem se conectar a um controlador de domínio para qualquer outra finalidade que não seja autenticação e Política de Grupo aplicativo. Em algumas violações, os invasores usaram ferramentas que já foram instaladas em controladores de domínio não apenas para obter acesso aos controladores de domínio, mas para modificar ou danificar o banco de dados AD DS.

Quando extraímos as definições de configuração do Internet Explorer em controladores de domínio, descobrimos que os usuários fizeram logon com contas que têm altos níveis de privilégio em Active Directory e usaram as contas para acessar a Internet e a intranet dos controladores de domínio. Em alguns casos, as contas configuraram as configurações do Internet Explorer nos controladores de domínio para permitir o download do conteúdo da Internet, e utilitários freeware foram baixados dos sites da Internet e instalados nos controladores de domínio. A configuração de segurança reforçada do Internet Explorer é habilitada para usuários e administradores por padrão, mas geralmente observamos que o foi desabilitado para administradores. Quando uma conta altamente privilegiada acessa a Internet e baixa o conteúdo para qualquer computador, esse computador é colocado em risco sério. Quando o computador é um controlador de domínio, toda a instalação do AD DS é colocada em risco.

##### <a name="protecting-domain-controllers"></a>Protegendo controladores de domínio
Os controladores de domínio devem ser tratados como componentes críticos da infraestrutura, protegidos de forma mais rígida e configurada de maneira mais rígida do que os servidores de arquivos, de impressão e de aplicativos. Os controladores de domínio não devem executar nenhum software que não seja necessário para que o controlador de domínio funcione ou não proteja o controlador de domínio contra ataques. Os controladores de domínio não devem ter permissão para acessar a Internet, e as configurações de segurança devem ser configuradas e impostas por objetos de Política de Grupo (GPOs). Recomendações detalhadas para a instalação, configuração e gerenciamento seguros de controladores de domínio são fornecidas na [proteção de controladores de domínio contra ataques](../../../ad-ds/plan/security-best-practices/Securing-Domain-Controllers-Against-Attack.md).

#### <a name="within-the-operating-system"></a>Dentro do sistema operacional
*Número da lei dois: se uma pessoa mal-intencionada puder alterar o sistema operacional em seu computador, ele não será mais o seu computador.* - [Dez leis imutáveis de segurança (versão 2,0)](https://www.microsoft.com/en-us/msrc?rtc=1)

Embora algumas organizações criem configurações de linha de base para servidores de tipos diferentes e permitam a personalização limitada do sistema operacional após sua instalação, a análise de ambientes comprometidos geralmente descobre um grande número de servidores implantados de maneira ad hoc e é configurado de forma manual e independente. As configurações entre dois servidores que executam a mesma função podem ser completamente diferentes, onde nenhum servidor está configurado com segurança. Por outro lado, as linhas de base de configuração do servidor podem ser impostas de forma consistente, mas também configuradas de forma consistente; ou seja, os servidores são configurados de uma maneira que cria a mesma vulnerabilidade em todos os servidores de um determinado tipo. A configuração incorreta inclui práticas como a desabilitação de recursos de segurança, a concessão de direitos e permissões excessivas a contas (especialmente contas de serviço), o uso de credenciais locais idênticas em todos os sistemas e a permissão de instalação de aplicativos e utilitários não autorizados que criam suas próprias vulnerabilidades.

##### <a name="disabling-security-features"></a>Desabilitando recursos de segurança
Às vezes, as organizações desabilitam o Firewall do Windows com a segurança avançada (WFAS) de uma crença de que o WFAS é difícil de configurar ou requer configuração com uso intensivo de trabalho. No entanto, a partir do Windows Server 2008, quando qualquer função ou recurso é instalado em um servidor, ele é configurado por padrão com os privilégios mínimos necessários para a função ou recurso para funcionar, e o Firewall do Windows é configurado automaticamente para dar suporte à função ou ao recurso. Ao desabilitar o WFAS (e não usar outro firewall baseado em host em seu lugar), as organizações aumentam a superfície de ataque de todo o ambiente do Windows. Os firewalls de perímetro fornecem alguma proteção contra ataques que direcionam diretamente um ambiente da Internet, mas não fornecem proteção contra ataques que exploram outros vetores de ataque, como ataques de [drive-by download](https://www.microsoft.com/security/sir/glossary/drive-by-download-sites.aspx) ou ataques originados de outros sistemas comprometidos na intranet.

As configurações de controle de conta de usuário (UAC) às vezes são desabilitadas em servidores porque a equipe administrativa encontra a intrusiva de prompts. Embora [suporte da Microsoft artigo 2526083](https://support.microsoft.com/kb/2526083) descreva os cenários em que o UAC pode ser desabilitado no Windows Server, a menos que você esteja executando uma instalação do Server Core (onde o UAC está desabilitado por Design), você não deve desabilitar o UAC em servidores sem consideração e pesquisa cuidadosa.

Em outros casos, as configurações do servidor são configuradas para valores menos seguros porque as organizações aplicam definições de configuração de servidor desatualizadas a novos sistemas operacionais, como a aplicação de linhas de base do Windows Server 2003 em computadores que executam o Windows Server 2012, Windows Server 2008 R2 ou Windows Server 2008, sem alterar as linhas de base para refletir as alterações no sistema operacional. Em vez de transportar linhas de base de servidor antigas para novos sistemas operacionais, ao implantar um novo sistema operacional, examine as alterações de segurança e definições de configuração para garantir que as configurações implementadas sejam aplicáveis e apropriadas para o novo sistema operacional.

##### <a name="granting-excessive-privilege"></a>Concedendo privilégios excessivos
Em quase todos os ambientes que avaliamos, o privilégio excessivo é concedido a contas locais e baseadas em domínio em sistemas Windows. Os usuários recebem direitos de administrador local em suas estações de trabalho, os servidores membros executam serviços configurados com direitos além do que precisam para funcionar, e os grupos de administradores locais na população do servidor contêm dezenas ou até mesmo centenas de contas locais e de domínio. O comprometimento de apenas uma conta com privilégios em um computador permite que os invasores comprometam as contas de todos os usuários e serviços que se conectam ao computador e coletem e aproveitem as credenciais para propagar o comprometimento para outros sistemas.

Embora o PTH (Pass-the-hash) e outros ataques de roubo de credenciais sejam onipresentes hoje, é porque há ferramentas disponíveis gratuitamente que tornam simples e fácil extrair as credenciais de outras contas privilegiadas quando um invasor obtiver acesso no nível do administrador ou do sistema a um computador. Mesmo sem ferramentas que permitem a coleta de credenciais de sessões de logon, um invasor com acesso privilegiado a um computador pode instalar facilmente os agentes de pressionamentos de tecla que capturam pressionamentos de teclas, capturas de tela e conteúdo da área de transferência. Um invasor com acesso privilegiado a um computador pode desabilitar o software antimalware, instalar rootkits, modificar arquivos protegidos ou instalar malware no computador que automatiza ataques ou transforma um servidor em um host [drive-by download](https://www.microsoft.com/security/sir/glossary/drive-by-download-sites.aspx) .

As táticas usadas para estender uma violação além de um único computador variam, mas a chave para propagar o comprometimento é a aquisição de acesso altamente privilegiado a sistemas adicionais. Ao reduzir o número de contas com acesso privilegiado a qualquer sistema, você reduz a superfície de ataque não apenas desse computador, mas a probabilidade de um invasor coletar credenciais valiosas do computador.

##### <a name="standardizing-local-administrator-credentials"></a>Padronizando credenciais de administrador local
Há muito tempo debater entre especialistas em segurança para saber se há valor na renomeação de contas de administrador local em computadores com Windows. O que é realmente importante sobre contas de administrador local é se eles estão configurados com o mesmo nome de usuário e senha em vários computadores.

Se a conta de administrador local for nomeada com o mesmo valor entre os servidores e a senha atribuída à conta também for configurada com o mesmo valor, os invasores poderão extrair as credenciais da conta em um computador no qual o administrador ou acesso no nível do sistema foi obtido. O invasor não precisa comprometer inicialmente a conta de administrador; Eles precisam comprometer apenas a conta de um usuário que seja membro do grupo local de administradores ou de uma conta de serviço configurada para execução como LocalSystem ou com privilégios de administrador. O invasor pode então extrair as credenciais para a conta de administrador e repetir essas credenciais em logons de rede para outros computadores na rede.

Desde que outro computador tenha uma conta local com o mesmo nome de usuário e senha (ou hash de senha) que as credenciais de conta que estão sendo apresentadas, a tentativa de logon será realizada com sucesso e o invasor obterá acesso privilegiado ao computador definido como destino. Nas versões atuais do Windows, a conta interna de administrador é [desabilitada por padrão](/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc753450(v=ws.11)), mas em sistemas operacionais herdados, a conta é habilitada por padrão.

> [!NOTE]
> Algumas organizações configuraram intencionalmente contas de administrador local para serem habilitadas na crença de que isso fornece uma "FailSafe" caso todas as outras contas privilegiadas estejam bloqueadas em um sistema. No entanto, mesmo que a conta de administrador local esteja desabilitada e não haja nenhuma outra conta disponível que possa habilitar a conta ou fazer logon no sistema com privilégios de administrador, o sistema poderá ser inicializado no modo de segurança e a conta de administrador local interna poderá ser reabilitada, conforme descrito em [suporte da Microsoft artigo 814777](https://support.microsoft.com/kb/814777). Além disso, se o sistema ainda aplicar GPOs com êxito, um GPO poderá ser modificado para (temporariamente) reabilitar a conta de administrador ou os grupos restritos poderão ser configurados para adicionar uma conta baseada em domínio ao grupo local de administradores. Os reparos podem ser executados e a conta de administrador pode ser novamente desabilitada. Para evitar efetivamente um comprometimento lateral que usa credenciais internas de conta de administrador local, nomes de usuário e senhas exclusivos devem ser configurados para contas de administrador local. Para implantar senhas exclusivas para contas de administrador local por meio de um GPO, consulte [solução para o gerenciamento de senha da conta de administrador interno por meio de GPO](/previous-versions/mt227395(v=msdn.10)) no TechNet.  

##### <a name="permitting-installation-of-unauthorized-applications"></a>Permitindo a instalação de aplicativos não autorizados
*Número da lei: se uma pessoa mal-intencionada puder persuadir você a executar seu programa em seu computador, ele não será mais o seu computador.* - [Dez leis imutáveis de segurança (versão 2,0)](https://www.microsoft.com/en-us/msrc?rtc=1)

Se uma organização implanta configurações de linha de base consistentes entre servidores, a instalação de aplicativos que não fazem parte da função definida de um servidor não deve ser permitida. Ao permitir que o software seja instalado que não faz parte da funcionalidade designada de um servidor, os servidores são expostos a uma instalação inadvertida ou mal-intencionada de software que aumenta a superfície de ataque do servidor, apresenta vulnerabilidades de aplicativo ou causa instabilidade no sistema.

#### <a name="applications"></a>Aplicativos
Conforme descrito anteriormente, os aplicativos são frequentemente instalados e configurados para usar contas que recebem mais privilégios do que o aplicativo realmente exige. Em alguns casos, a documentação do aplicativo especifica que as contas de serviço devem ser membros do grupo de administradores locais de um servidor ou devem ser configurados para serem executados no contexto do LocalSystem. Isso geralmente não ocorre porque o aplicativo requer esses direitos, mas como determinar quais direitos e permissões as contas de serviço de um aplicativo precisam exigir investimento em tempo e esforço adicionais. Se um aplicativo não for instalado com os privilégios mínimos necessários para o aplicativo e seus recursos configurados para funcionar, o sistema será exposto a ataques que aproveitam os privilégios do aplicativo sem qualquer ataque contra o próprio sistema operacional.

### <a name="lack-of-secure-application-development-practices"></a>Falta de práticas seguras de desenvolvimento de aplicativos
A infraestrutura existe para dar suporte a cargas de trabalho de negócios. Onde essas cargas de trabalho são implementadas em aplicativos personalizados, é essencial garantir que os aplicativos sejam desenvolvidos usando práticas recomendadas seguras. A análise da causa raiz de incidentes em toda a empresa geralmente revela que um comprometimento inicial é afetado por meio de aplicativos personalizados, particularmente aqueles que são voltados para a Internet. A maioria dessas comprometeções é realizada por meio do comprometimento de ataques bem conhecidos, como ataques de injeção de SQL (SQLi) e XSS (script entre sites).

A injeção de SQL é uma vulnerabilidade de aplicativo que permite que a entrada definida pelo usuário modifique uma instrução SQL que é passada para o banco de dados para execução. Essa entrada pode ser fornecida por meio de um campo no aplicativo, um parâmetro (como a cadeia de caracteres de consulta ou um cookie) ou outros métodos. O resultado dessa injeção é que a instrução SQL fornecida para o banco de dados é fundamentalmente diferente do que o desenvolvedor pretendia. Veja, por exemplo, uma consulta comum usada na avaliação de uma combinação de nome de usuário/senha:

`SELECT userID FROM users WHERE username = 'sUserName' AND password = 'sPassword'`

Quando isso é recebido pelo servidor de banco de dados, ele instrui o servidor a examinar a tabela de usuários e retornar qualquer registro de userID em que o nome de usuário e a senha correspondam aos fornecidos pelo usuário (supostamente por meio de um formulário de logon de algum tipo). Naturalmente, a intenção do desenvolvedor, nesse caso, é retornar apenas um registro válido se um nome de usuário e senha corretos puderem ser fornecidos pelo usuário. Se algum estiver incorreto, o servidor de banco de dados não poderá localizar um registro correspondente e retornar um resultado vazio.

O problema ocorre quando um invasor faz algo inesperado, como fornecer seu próprio SQL em vez de dados válidos. Como o SQL é interpretado instantaneamente pelo servidor de banco de dados, o código injetado seria processado como se o desenvolvedor tivesse colocado em si mesmo. Por exemplo, se o invasor inserir o **administrador** para a ID de usuário e a **XYZ** ou **1 = 1** como a senha, a instrução resultante processada pelo banco de dados será:

`SELECT userID FROM users WHERE username = 'administrator' AND password = 'xyz' OR 1=1`

Quando essa consulta é processada pelo servidor de banco de dados, todas as linhas na tabela serão retornadas na consulta porque 1 = 1 sempre será avaliado como true, portanto, não importa se o nome de usuário e a senha corretos são conhecidos ou fornecidos. O resultado líquido na maioria dos casos é que o usuário será conectado como o primeiro usuário no banco de dados do usuário; na maioria dos casos, esse será o usuário administrativo.

Além de simplesmente fazer logon, instruções SQL malformadas, como essa, podem ser usadas para adicionar, excluir ou alterar dados, ou até mesmo remover (excluir) tabelas inteiras de um banco de dado. Nos casos mais extremos em que SQLi é combinado com privilégios excessivos, os comandos do sistema operacional podem ser executados para habilitar a criação de novos usuários, para baixar as ferramentas de ataque ou para executar quaisquer outras ações de invasores escolhendo.

Em scripts entre sites, a vulnerabilidade é introduzida na saída do aplicativo. Um ataque começa com um invasor que fornece dados malformados ao aplicativo, mas, nesse caso, os dados malformados estão na forma de código de script (como JavaScript) que será executado pelo navegador da vítima. A exploração de uma vulnerabilidade de XSS pode permitir que um invasor execute qualquer função do aplicativo de destino no contexto do usuário que iniciou o navegador. Os ataques de XSS normalmente são iniciados por um email de phishing que incentiva o usuário a clicar em um link que se conecta ao aplicativo e executa o código de ataque.

O XSS é frequentemente explorado em cenários de comércio eletrônico online e de e-commerce, em que um invasor pode fazer compras ou transferir dinheiro no contexto do usuário explorado. No caso de um ataque de destino em um aplicativo de gerenciamento de identidade baseado na Web personalizado, ele pode permitir que um invasor crie suas próprias identidades, modifique permissões e direitos e cause um comprometimento do sistema.

Embora uma discussão completa sobre scripts entre sites e a injeção de SQL esteja fora do escopo deste documento, o [OWASP (Open Web Application Security Project)](https://www.owasp.org/index.php/Main_Page) publica uma lista dos 10 principais com uma discussão aprofundada sobre as vulnerabilidades e as contramedidas.

Independentemente do investimento em segurança de infraestrutura, se aplicativos mal projetados e escritos forem implantados nessa infraestrutura, o ambiente ficará vulnerável a ataques. Até mesmo as infra-estruturas bem protegidas geralmente não podem fornecer contramedidas efetivas a esses ataques de aplicativos. Compor o problema, aplicativos mal projetados podem exigir que as contas de serviço recebam permissões excessivas para que o aplicativo funcione.

O Microsoft Security Development Lifecycle (SDL) é um conjunto de controles de processo estrutural que funcionam para melhorar a segurança, começando na coleta de requisitos e estendendo o ciclo de vida do aplicativo até que ele seja encerrado. Essa integração de controles de segurança efetivos não é apenas essencial do ponto de vista da segurança, é essencial garantir que a segurança do aplicativo seja o custo e a programação em vigor. Avaliar um aplicativo quanto a problemas de segurança quando ele é efetivamente preenchido por código exige que as organizações tomem decisões sobre a segurança do aplicativo somente antes ou mesmo após a implantação do aplicativo. Uma organização pode optar por resolver as falhas do aplicativo antes de implantar o aplicativo em produção, incorrer em custos e atrasos, ou o aplicativo pode ser implantado em produção com falhas de segurança conhecidas, expondo a organização a ser comprometida.

Algumas organizações colocam o custo total de corrigir um problema de segurança no código de produção acima de $10000 por questão, e os aplicativos desenvolvidos sem um SDL efetivo podem calcular mais de dez problemas de alta gravidade por 100.000 linhas de código. Em aplicativos grandes, os custos são escalonados rapidamente. Por outro lado, muitas empresas definem um benchmark de menos de um problema por 100.000 linhas de código no estágio de revisão de código final do SDL e visam nenhum problema em aplicativos de alto risco na produção.

A implementação do SDL melhora a segurança, incluindo os requisitos de segurança no início da coleta de requisitos e o design de um aplicativo fornece a modelagem de ameaças para aplicativos de alto risco; requer treinamento e monitoramento efetivos de desenvolvedores; e exige padrões e práticas de código claros e consistentes. O efeito líquido de um SDL é melhorias significativas na segurança do aplicativo, reduzindo o custo de desenvolvimento, implantação, manutenção e descomissionamento de um aplicativo. Embora uma discussão detalhada sobre o design e a implementação do SDL esteja além do escopo deste documento, consulte o [ciclo de vida do desenvolvimento de segurança da Microsoft](https://www.microsoft.com/security/sdl/default.aspx) para obter orientações e informações detalhadas.

